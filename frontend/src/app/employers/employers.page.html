<ion-header [translucent]="true">
  <ion-toolbar>
    <ion-title>Inventario</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <section class="filter-bar">
    <div>
      <p class="filter-label">Tipo seleccionado</p>
      <h3>{{ getTipoLabel(selectedTipo) }}</h3>
    </div>
    <ion-button id="tipoFilterTriggerEmployers" fill="outline" color="primary" size="small">
      <ion-icon slot="start" name="funnel-outline"></ion-icon>
      {{ getTipoLabel(selectedTipo) }}
    </ion-button>
  </section>

  <ion-popover trigger="tipoFilterTriggerEmployers" triggerAction="click" [dismissOnSelect]="true">
    <ng-template>
      <ion-content class="tipo-popover">
        <ion-list>
          <ion-item
            button
            detail="false"
            *ngFor="let tipo of tipos"
            (click)="selectTipo(tipo.value)"
          >
            <ion-label>{{ tipo.label }}</ion-label>
            <ion-icon
              slot="end"
              name="checkmark-outline"
              *ngIf="selectedTipo === tipo.value"
            ></ion-icon>
          </ion-item>
        </ion-list>
      </ion-content>
    </ng-template>
  </ion-popover>

  <div *ngIf="isLoading" class="loading-placeholder">
    <ion-skeleton-text animated style="width: 100%; height: 120px"></ion-skeleton-text>
    <ion-skeleton-text animated style="width: 100%; height: 120px"></ion-skeleton-text>
  </div>

  <ion-list *ngIf="!isLoading && products.length" class="inventory-list">
    <ion-card *ngFor="let product of products">
      <ion-item lines="none">
        <ion-thumbnail slot="start">
          <img
            [src]="product.imagen || product.image || 'https://images.unsplash.com/photo-1563636619-e9143da7973b?w=400&auto=format'"
            alt="{{ product.nombre }}"
          />
        </ion-thumbnail>
        <ion-label>
          <h2>{{ product.nombre }}</h2>
          <p>{{ product.codigo || ('ID #' + (product.idarticulo || product.id)) }}</p>
        </ion-label>
        <ion-chip color="tertiary">{{ (product.tipo || 'general') | titlecase }}</ion-chip>
      </ion-item>
      <ion-card-content>
        <div class="inventory-meta">
          <div>
            <span class="meta-label">Precio</span>
            <strong>
              {{ product.precio_venta | currency : 'EUR' }}
              <span class="offer-label" *ngIf="product.oferta">OFERTA</span>
            </strong>
          </div>
          <div>
            <span class="meta-label">Stock</span>
            <strong>{{ product.stock }}</strong>
          </div>
        </div>
        <p class="description">{{ product.descripcion }}</p>
        <div class="inventory-actions">
          <ion-button fill="outline" size="small" (click)="editProduct(product)">
            <ion-icon slot="start" name="create"></ion-icon>
            Editar
          </ion-button>
          <ion-button fill="outline" color="danger" size="small" (click)="deleteProduct(product.idarticulo || product.id)">
            <ion-icon slot="start" name="trash"></ion-icon>
            Borrar
          </ion-button>
        </div>
      </ion-card-content>
    </ion-card>
  </ion-list>

  <div *ngIf="!isLoading && !products.length" class="empty-state">
    <p>No hay art√≠culos para este filtro.</p>
  </div>

  <ion-fab vertical="bottom" horizontal="end" slot="fixed">
    <ion-fab-button (click)="openCreateModal()">
      <ion-icon name="add"></ion-icon>
    </ion-fab-button>
  </ion-fab>
</ion-content>
